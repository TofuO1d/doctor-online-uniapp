"use strict";const e=require("../../../common/vendor.js"),o=require("../../../services/user.js"),r=require("../../../stores/user.js");if(require("../../../utils/http.js"),!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("custom-countdown")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../components/custom-countdown/custom-countdown.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const s={options:{styleIsolation:"shared"}},n=Object.assign(s,{__name:"mobile",setup(s){const n=r.useUserStore(),t=e.ref(!1),i=e.ref(!1),u=e.ref("获取验证码"),l=e.ref(),a=e.ref({mobile:"",code:""}),c={mobile:{rules:[{required:!0,errorMessage:"请填写手机号码"},{pattern:"^1\\d{10}$",errorMessage:"手机号码格式不正确"}]},code:{rules:[{required:!0,errorMessage:"请输入验证码"},{pattern:"^\\d{6}$",errorMessage:"验证码格式不正确"}]}};function m(){t.value=!t.value}async function d(){if(!t.value)return e.index.utils.toast("请先同意协议!");try{const r=await l.value.validate(),{code:s,data:t,message:i}=await o.loginByMobileApi(r);if(1e4!==s)return e.index.utils.toast(i);n.token=t.token,n.userId=t.id,"switchTab"===n.openType?e.index.switchTab({url:n.redirectURL}):e.index.redirectTo({url:n.redirectURL})}catch(r){console.log(r)}}function p(){u.value="重新获取验证码",i.value=!1}async function f(){try{await l.value.validateField(["mobile"]);const{code:r,message:s}=await o.verifyCodeApi({mobile:a.value.mobile,type:"login"});if(1e4!==r)return e.index.utils.toast(s);e.index.utils.toast("验证码已发送，请查收!"),i.value=!0}catch(r){console.log(r)}}return(o,r)=>e.e({a:e.o((e=>a.value.mobile=e)),b:e.p({"input-border":!1,clearable:!1,placeholder:"请输入手机号","placeholder-style":"color: #C3C3C5",modelValue:a.value.mobile}),c:e.p({name:"mobile"}),d:e.o((e=>a.value.code=e)),e:e.p({"input-border":!1,clearable:!1,placeholder:"请输入验证码","placeholder-style":"color: #C3C3C5",modelValue:a.value.code}),f:i.value},i.value?{g:e.o(p),h:e.p({second:59,"show-day":!1,"show-hour":!1,"show-miniute":!1,color:"#16C2A3"})}:{i:e.t(u.value),j:e.o(f)},{k:e.p({name:"code"}),l:e.o(m),m:t.value,n:e.o(d),o:e.sr(l,"6b84ff02-0",{k:"formRef"}),p:e.p({model:a.value,rules:c})})}});wx.createComponent(n);
