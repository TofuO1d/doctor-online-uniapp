import{ag as e,ah as t,a7 as r,C as n,q as o,ai as i,aj as a,ak as s,G as c}from"./index-0333b418.js";var u=Object.prototype.toString;function l(e){return"[object Array]"===u.call(e)}function f(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),l(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}function d(){let e={};function t(t,r){"object"==typeof e[r]&&"object"==typeof t?e[r]=d(e[r],t):e[r]="object"==typeof t?d({},t):t}for(let r=0,n=arguments.length;r<n;r++)f(arguments[r],t);return e}function p(e){return void 0===e}function h(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function m(e,t,r){if(!t)return e;var n,o;if(r)n=r(t);else if(o=t,"undefined"!=typeof URLSearchParams&&o instanceof URLSearchParams)n=t.toString();else{var i=[];f(t,(function(e,t){null!=e&&(l(e)?t+="[]":e=[e],f(e,(function(e){!function(e){return"[object Date]"===u.call(e)}(e)?function(e){return null!==e&&"object"==typeof e}(e)&&(e=JSON.stringify(e)):e=e.toISOString(),i.push(h(t)+"="+h(e))})))})),n=i.join("&")}if(n){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}const g=(e,t)=>{let r={};return e.forEach((e=>{p(t[e])||(r[e]=t[e])})),r},y=n=>(n=>new Promise(((o,i)=>{let a=m((s=n.baseURL,c=n.url,s&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(s,c):c),n.params,n.paramsSerializer);var s,c;const u={url:a,header:n.header,complete:e=>{n.fullPath=a,e.config=n,e.rawData=e.data;try{let t=!1;const r=typeof n.forcedJSONParsing;"boolean"===r?t=n.forcedJSONParsing:"object"===r&&(t=(n.forcedJSONParsing.include||[]).includes(n.method)),t&&"string"==typeof e.data&&(e.data=JSON.parse(e.data))}catch(t){}!function(e,t,r){const n=r.config.validateStatus,o=r.statusCode;!o||n&&!n(o)?t(r):e(r)}(o,i,e)}};let l;if("UPLOAD"===n.method){delete u.header["content-type"],delete u.header["Content-Type"];let t={filePath:n.filePath,name:n.name};const r=["files","file","timeout","formData"];l=e({...u,...t,...g(r,n)})}else if("DOWNLOAD"===n.method){const e=["timeout"];l=t({...u,...g(e,n)})}else{const e=["data","method","timeout","dataType","responseType","withCredentials"];l=r({...u,...g(e,n)})}n.getTask&&n.getTask(l,n)})))(n);function b(){this.handlers=[]}b.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},b.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},b.prototype.forEach=function(e){this.handlers.forEach((t=>{null!==t&&e(t)}))};const O=(e,t,r)=>{let n={};return e.forEach((e=>{p(r[e])?p(t[e])||(n[e]=t[e]):n[e]=r[e]})),n},j={baseURL:"",header:{},method:"GET",dataType:"json",paramsSerializer:null,responseType:"text",custom:{},timeout:6e4,withCredentials:!1,validateStatus:function(e){return e>=200&&e<300},forcedJSONParsing:!0};var w=function(){function e(e,t){return null!=t&&e instanceof t}var t,r,n;try{t=Map}catch(s){t=function(){}}try{r=Set}catch(s){r=function(){}}try{n=Promise}catch(s){n=function(){}}function o(i,s,c,u,l){"object"==typeof s&&(c=s.depth,u=s.prototype,l=s.includeNonEnumerable,s=s.circular);var f=[],d=[],p="undefined"!=typeof Buffer;return void 0===s&&(s=!0),void 0===c&&(c=1/0),function i(c,h){if(null===c)return null;if(0===h)return c;var m,g;if("object"!=typeof c)return c;if(e(c,t))m=new t;else if(e(c,r))m=new r;else if(e(c,n))m=new n((function(e,t){c.then((function(t){e(i(t,h-1))}),(function(e){t(i(e,h-1))}))}));else if(o.__isArray(c))m=[];else if(o.__isRegExp(c))m=new RegExp(c.source,a(c)),c.lastIndex&&(m.lastIndex=c.lastIndex);else if(o.__isDate(c))m=new Date(c.getTime());else{if(p&&Buffer.isBuffer(c))return Buffer.from?m=Buffer.from(c):(m=new Buffer(c.length),c.copy(m)),m;e(c,Error)?m=Object.create(c):void 0===u?(g=Object.getPrototypeOf(c),m=Object.create(g)):(m=Object.create(u),g=u)}if(s){var y=f.indexOf(c);if(-1!=y)return d[y];f.push(c),d.push(m)}for(var b in e(c,t)&&c.forEach((function(e,t){var r=i(t,h-1),n=i(e,h-1);m.set(r,n)})),e(c,r)&&c.forEach((function(e){var t=i(e,h-1);m.add(t)})),c){Object.getOwnPropertyDescriptor(c,b)&&(m[b]=i(c[b],h-1));try{if("undefined"===Object.getOwnPropertyDescriptor(c,b).set)continue;m[b]=i(c[b],h-1)}catch(T){if(T instanceof TypeError)continue;if(T instanceof ReferenceError)continue}}if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(c);for(b=0;b<O.length;b++){var j=O[b];(!(P=Object.getOwnPropertyDescriptor(c,j))||P.enumerable||l)&&(m[j]=i(c[j],h-1),Object.defineProperty(m,j,P))}}if(l){var w=Object.getOwnPropertyNames(c);for(b=0;b<w.length;b++){var P,v=w[b];(P=Object.getOwnPropertyDescriptor(c,v))&&P.enumerable||(m[v]=i(c[v],h-1),Object.defineProperty(m,v,P))}}return m}(i,c)}function i(e){return Object.prototype.toString.call(e)}function a(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return o.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},o.__objToStr=i,o.__isDate=function(e){return"object"==typeof e&&"[object Date]"===i(e)},o.__isArray=function(e){return"object"==typeof e&&"[object Array]"===i(e)},o.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===i(e)},o.__getRegExpFlags=a,o}();const P=n("user",(()=>{const e=o(""),t=o("/pages/index/index"),r=o("switchTab");return{token:e,userId:o(""),redirectURL:t,openType:r}}),{persist:{paths:["token","userId","redirectURL","openType"]}}),v=["pages/index/index","pages/wiki/index","pages/notify/index","pages/my/index"],T=new class{constructor(e={}){var t;t=e,"[object Object]"!==Object.prototype.toString.call(t)&&(e={},console.warn("设置全局参数必须接收一个Object")),this.config=w({...j,...e}),this.interceptors={request:new b,response:new b}}setConfig(e){this.config=e(this.config)}middleware(e){e=((e,t={})=>{const r=t.method||e.method||"GET";let n={baseURL:t.baseURL||e.baseURL||"",method:r,url:t.url||"",params:t.params||{},custom:{...e.custom||{},...t.custom||{}},header:d(e.header||{},t.header||{})};if(n={...n,...O(["getTask","validateStatus","paramsSerializer","forcedJSONParsing"],e,t)},"DOWNLOAD"===r){const r=["timeout"];n={...n,...O(r,e,t)}}else if("UPLOAD"===r)delete n.header["content-type"],delete n.header["Content-Type"],["files","file","filePath","name","timeout","formData"].forEach((e=>{p(t[e])||(n[e]=t[e])})),p(n.timeout)&&!p(e.timeout)&&(n.timeout=e.timeout);else{const r=["data","timeout","dataType","responseType","withCredentials"];n={...n,...O(r,e,t)}}return n})(this.config,e);let t=[y,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)r=r.then(t.shift(),t.shift());return r}request(e={}){return this.middleware(e)}get(e,t={}){return this.middleware({url:e,method:"GET",...t})}post(e,t,r={}){return this.middleware({url:e,data:t,method:"POST",...r})}put(e,t,r={}){return this.middleware({url:e,data:t,method:"PUT",...r})}delete(e,t,r={}){return this.middleware({url:e,data:t,method:"DELETE",...r})}connect(e,t,r={}){return this.middleware({url:e,data:t,method:"CONNECT",...r})}head(e,t,r={}){return this.middleware({url:e,data:t,method:"HEAD",...r})}options(e,t,r={}){return this.middleware({url:e,data:t,method:"OPTIONS",...r})}trace(e,t,r={}){return this.middleware({url:e,data:t,method:"TRACE",...r})}upload(e,t={}){return t.url=e,t.method="UPLOAD",this.middleware(t)}download(e,t={}){return t.url=e,t.method="DOWNLOAD",this.middleware(t)}get version(){return"3.1.0"}}({baseURL:"https://consult-api.itheima.net/",custom:{loading:!0}});T.interceptors.request.use((function(e){e.custom.loading&&i({title:"正在加载...",mask:!0});const t=P(),r={};return t.token&&(r.Authorization="Bearer "+t.token),e.header={...r,...e.header},e}),(function(e){return Promise.reject(e)})),T.interceptors.response.use((function({statusCode:e,data:t,config:r}){return a(),t}),(function(e){return a(),401===e.statusCode&&function(){const e=s(),t=e[e.length-1],r=t.$page.fullPath,n=v.includes(t.route)?"switchTab":"redirectTo",o=P();o.redirectURL=r,o.openType=n,c({url:"/pages/login/index"})}(),Promise.reject(e)}));export{T as h,P as u};
