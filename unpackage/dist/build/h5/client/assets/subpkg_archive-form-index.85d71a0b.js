import{K as e,l as t,o as a,a as l,w as s,g as i,t as o,d,F as r,L as c,e as n,n as u,f as h,A as m,j as f,i as p,M as g,N as y,O as b,H as v,P as x,q as k,Q as _,R as C,T as D,k as S}from"./index-0333b418.js";import{_ as L}from"./uni-easyinput.f5dc7f12.js";import{r as V}from"./uni-app.es.6fb9258e.js";import{_ as T,a as $}from"./uni-forms.a2627eed.js";import{_ as I}from"./uni-load-more.29a05208.js";import{_ as w}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as F}from"./scroll-page.1487e938.js";import{p as E,a as j,u as B}from"./patient.3a4dde9c.js";import"./uni-icons.306a74c1.js";import"./http.dd4042ae.js";const R=w({name:"uniDataChecklist",mixins:[e.mixinDatacom||{}],emits:["input","update:modelValue","change"],props:{mode:{type:String,default:"default"},multiple:{type:Boolean,default:!1},value:{type:[Array,String,Number],default:()=>""},modelValue:{type:[Array,String,Number],default:()=>""},localdata:{type:Array,default:()=>[]},min:{type:[Number,String],default:""},max:{type:[Number,String],default:""},wrap:{type:Boolean,default:!1},icon:{type:String,default:"left"},selectedColor:{type:String,default:""},selectedTextColor:{type:String,default:""},emptyText:{type:String,default:"暂无数据"},disabled:{type:Boolean,default:!1},map:{type:Object,default:()=>({text:"text",value:"value"})}},watch:{localdata:{handler(e){this.range=e,this.dataList=this.getDataList(this.getSelectedValue(e))},deep:!0},mixinDatacomResData(e){this.range=e,this.dataList=this.getDataList(this.getSelectedValue(e))},value(e){this.dataList=this.getDataList(e)},modelValue(e){this.dataList=this.getDataList(e)}},data:()=>({dataList:[],range:[],contentText:{contentdown:"查看更多",contentrefresh:"加载中",contentnomore:"没有更多"},isLocal:!0,styles:{selectedColor:"#2979ff",selectedTextColor:"#666"},isTop:0}),computed:{dataValue(){return""===this.value?this.modelValue:(this.modelValue,this.value)}},created(){this.localdata&&0!==this.localdata.length?(this.isLocal=!0,this.range=this.localdata,this.dataList=this.getDataList(this.getSelectedValue(this.range))):this.collection&&(this.isLocal=!1,this.loadData())},methods:{loadData(){this.mixinDatacomGet().then((e=>{this.mixinDatacomResData=e.result.data,0===this.mixinDatacomResData.length?(this.isLocal=!1,this.mixinDatacomErrorMessage=this.emptyText):this.isLocal=!0})).catch((e=>{this.mixinDatacomErrorMessage=e.message}))},getForm(e="uniForms"){let t=this.$parent,a=t.$options.name;for(;a!==e;){if(t=t.$parent,!t)return!1;a=t.$options.name}return t},chagne(e){const t=e.detail.value;let a={value:[],data:[]};if(this.multiple)this.range.forEach((e=>{t.includes(e[this.map.value]+"")&&(a.value.push(e[this.map.value]),a.data.push(e))}));else{const e=this.range.find((e=>e[this.map.value]+""===t));e&&(a={value:e[this.map.value],data:e})}this.$emit("input",a.value),this.$emit("update:modelValue",a.value),this.$emit("change",{detail:a}),this.multiple?this.dataList=this.getDataList(a.value,!0):this.dataList=this.getDataList(a.value)},getDataList(e){let t=JSON.parse(JSON.stringify(this.range)),a=[];return this.multiple&&(Array.isArray(e)||(e=[])),t.forEach(((t,l)=>{if(t.disabled=t.disable||t.disabled||!1,this.multiple)if(e.length>0){let a=e.find((e=>e===t[this.map.value]));t.selected=void 0!==a}else t.selected=!1;else t.selected=e===t[this.map.value];a.push(t)})),this.setRange(a)},setRange(e){let t=e.filter((e=>e.selected)),a=Number(this.min)||0,l=Number(this.max)||"";return e.forEach(((s,i)=>{if(this.multiple){if(t.length<=a){void 0!==t.find((e=>e[this.map.value]===s[this.map.value]))&&(s.disabled=!0)}if(t.length>=l&&""!==l){void 0===t.find((e=>e[this.map.value]===s[this.map.value]))&&(s.disabled=!0)}}this.setStyles(s,i),e[i]=s})),e},setStyles(e,t){e.styleBackgroud=this.setStyleBackgroud(e),e.styleIcon=this.setStyleIcon(e),e.styleIconText=this.setStyleIconText(e),e.styleRightIcon=this.setStyleRightIcon(e)},getSelectedValue(e){if(!this.multiple)return this.dataValue;let t=[];return e.forEach((e=>{e.selected&&t.push(e[this.map.value])})),this.dataValue.length>0?this.dataValue:t},setStyleBackgroud(e){let t={},a=this.selectedColor?this.selectedColor:"#2979ff";this.selectedColor&&("list"!==this.mode&&(t["border-color"]=e.selected?a:"#DCDFE6"),"tag"===this.mode&&(t["background-color"]=e.selected?a:"#f5f5f5"));let l="";for(let s in t)l+=`${s}:${t[s]};`;return l},setStyleIcon(e){let t={},a="";if(this.selectedColor){let a=this.selectedColor?this.selectedColor:"#2979ff";t["background-color"]=e.selected?a:"#fff",t["border-color"]=e.selected?a:"#DCDFE6",!e.selected&&e.disabled&&(t["background-color"]="#F2F6FC",t["border-color"]=e.selected?a:"#DCDFE6")}for(let l in t)a+=`${l}:${t[l]};`;return a},setStyleIconText(e){let t={},a="";if(this.selectedColor){let a=this.selectedColor?this.selectedColor:"#2979ff";"tag"===this.mode?t.color=e.selected?this.selectedTextColor?this.selectedTextColor:"#fff":"#666":t.color=e.selected?this.selectedTextColor?this.selectedTextColor:a:"#666",!e.selected&&e.disabled&&(t.color="#999")}for(let l in t)a+=`${l}:${t[l]};`;return a},setStyleRightIcon(e){let t={},a="";"list"===this.mode&&(t["border-color"]=e.selected?this.styles.selectedColor:"#DCDFE6");for(let l in t)a+=`${l}:${t[l]};`;return a}}},[["render",function(e,k,_,C,D,S){const L=V(t("uni-load-more"),I),T=f,$=p,w=g,F=y,E=b,j=v,B=x;return a(),l($,{class:"uni-data-checklist",style:u({"margin-top":D.isTop+"px"})},{default:s((()=>[D.isLocal?(a(),d(r,{key:1},[_.multiple?(a(),l(E,{key:0,class:c(["checklist-group",{"is-list":"list"===_.mode||_.wrap}]),onChange:S.chagne},{default:s((()=>[(a(!0),d(r,null,n(D.dataList,((e,t)=>(a(),l(F,{class:c(["checklist-box",["is--"+_.mode,e.selected?"is-checked":"",_.disabled||e.disabled?"is-disable":"",0!==t&&"list"===_.mode?"is-list-border":""]]),style:u(e.styleBackgroud),key:t},{default:s((()=>[h(w,{class:"hidden",hidden:"",disabled:_.disabled||!!e.disabled,value:e[_.map.value]+"",checked:e.selected},null,8,["disabled","value","checked"]),"tag"!==_.mode&&"list"!==_.mode||"list"===_.mode&&"left"===_.icon?(a(),l($,{key:0,class:"checkbox__inner",style:u(e.styleIcon)},{default:s((()=>[h($,{class:"checkbox__inner-icon"})])),_:2},1032,["style"])):m("",!0),h($,{class:c(["checklist-content",{"list-content":"list"===_.mode&&"left"===_.icon}])},{default:s((()=>[h(T,{class:"checklist-text",style:u(e.styleIconText)},{default:s((()=>[i(o(e[_.map.text]),1)])),_:2},1032,["style"]),"list"===_.mode&&"right"===_.icon?(a(),l($,{key:0,class:"checkobx__list",style:u(e.styleBackgroud)},null,8,["style"])):m("",!0)])),_:2},1032,["class"])])),_:2},1032,["class","style"])))),128))])),_:1},8,["class","onChange"])):(a(),l(B,{key:1,class:c(["checklist-group",{"is-list":"list"===_.mode,"is-wrap":_.wrap}]),onChange:S.chagne},{default:s((()=>[(a(!0),d(r,null,n(D.dataList,((e,t)=>(a(),l(F,{class:c(["checklist-box",["is--"+_.mode,e.selected?"is-checked":"",_.disabled||e.disabled?"is-disable":"",0!==t&&"list"===_.mode?"is-list-border":""]]),style:u(e.styleBackgroud),key:t},{default:s((()=>[h(j,{class:"hidden",hidden:"",disabled:_.disabled||e.disabled,value:e[_.map.value]+"",checked:e.selected},null,8,["disabled","value","checked"]),"tag"!==_.mode&&"list"!==_.mode||"list"===_.mode&&"left"===_.icon?(a(),l($,{key:0,class:"radio__inner",style:u(e.styleBackgroud)},{default:s((()=>[h($,{class:"radio__inner-icon",style:u(e.styleIcon)},null,8,["style"])])),_:2},1032,["style"])):m("",!0),h($,{class:c(["checklist-content",{"list-content":"list"===_.mode&&"left"===_.icon}])},{default:s((()=>[h(T,{class:"checklist-text",style:u(e.styleIconText)},{default:s((()=>[i(o(e[_.map.text]),1)])),_:2},1032,["style"]),"list"===_.mode&&"right"===_.icon?(a(),l($,{key:0,style:u(e.styleRightIcon),class:"checkobx__list"},null,8,["style"])):m("",!0)])),_:2},1032,["class"])])),_:2},1032,["class","style"])))),128))])),_:1},8,["class","onChange"]))],64)):(a(),l($,{key:0,class:"uni-data-loading"},{default:s((()=>[e.mixinDatacomErrorMessage?(a(),l(T,{key:1},{default:s((()=>[i(o(e.mixinDatacomErrorMessage),1)])),_:1})):(a(),l(L,{key:0,status:"loading",iconType:"snow",iconSize:18,"content-text":D.contentText},null,8,["content-text"]))])),_:1}))])),_:1},8,["style"])}],["__scopeId","data-v-56cecf7b"]]),M=w({__name:"index",props:{id:String},setup(e){const o=e,d=k(),r=k({name:"张三",idCard:"110101198702171378",gender:1,defaultFlag:0}),c={name:{rules:[{required:!0,errorMessage:"请填写患者姓名"},{pattern:"^[一-龥]{2,5}$",errorMessage:"患者姓名为2-5位中文"}]},idCard:{rules:[{required:!0,errorMessage:"请输入身份证号"},{pattern:"^[1-9]\\d{5}(?:18|19|20)\\d{2}(?:0[1-9]|10|11|12)(?:0[1-9]|[1-2]\\d|30|31)\\d{3}[\\dXx]$",errorMessage:"身份证号格式不正确"}]},gender:{rules:[{required:!0,errorMessage:"请勾选患者姓名"},{validateFunction:(e,t,a,l)=>(a.idCard.slice(16,17)%2!==t&&l("选择的性别与身份号中性别不一致"),!0)}]}};async function n(){try{await d.value.validate();o.id?async function(){const{code:e,message:t}=await B(r.value);if(1e4!==e)return uni.utils.toast(t);C()}():async function(){const{code:e,message:t}=await j(r.value);if(1e4!==e)return uni.utils.toast(t);C()}()}catch(e){console.log(e)}}function u(e){r.value.defaultFlag=e.detail.value?1:0}return async function(){if(!o.id)return;_({title:"编辑患者"});const{code:e,data:{genderValue:t,age:a,...l}}=await E(o.id);r.value=l}(),(e,o)=>{const m=V(t("uni-easyinput"),L),f=V(t("uni-forms-item"),T),g=V(t("uni-data-checkbox"),R),y=D,b=p,v=S,x=V(t("uni-forms"),$),k=V(t("scroll-page"),F);return a(),l(k,null,{default:s((()=>[h(b,{class:"archive-page"},{default:s((()=>[h(x,{border:"","label-width":"220rpx",model:r.value,rules:c,ref_key:"formRef",ref:d},{default:s((()=>[h(f,{label:"患者姓名",name:"name"},{default:s((()=>[h(m,{modelValue:r.value.name,"onUpdate:modelValue":o[0]||(o[0]=e=>r.value.name=e),"placeholder-style":"color: #C3C3C5; font-size: 32rpx",styles:{color:"#121826"},"input-border":!1,clearable:!1,placeholder:"请填写真实姓名"},null,8,["modelValue"])])),_:1}),h(f,{label:"患者身份证号",name:"idCard"},{default:s((()=>[h(m,{modelValue:r.value.idCard,"onUpdate:modelValue":o[1]||(o[1]=e=>r.value.idCard=e),"placeholder-style":"color: #C3C3C5; font-size: 32rpx",styles:{color:"#121826"},"input-border":!1,clearable:!1,placeholder:"请填写身份证号"},null,8,["modelValue"])])),_:1}),h(f,{label:"患者性别",name:"gender"},{default:s((()=>[h(g,{modelValue:r.value.gender,"onUpdate:modelValue":o[2]||(o[2]=e=>r.value.gender=e),selectedColor:"#16C2A3",localdata:[{text:"男",value:1},{text:"女",value:0}]},null,8,["modelValue"])])),_:1}),h(f,{label:"默认就诊人"},{default:s((()=>[h(b,{class:"uni-switch"},{default:s((()=>[h(y,{onChange:u,checked:1===r.value.defaultFlag,color:"#20c6b2",style:{transform:"scale(0.7)"}},null,8,["checked"])])),_:1})])),_:1}),h(v,{onClick:n,class:"uni-button"},{default:s((()=>[i("保存")])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})}}},[["__scopeId","data-v-37dfde24"]]);export{M as default};
