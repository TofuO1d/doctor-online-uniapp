import{o as t,a as e,w as a,f as i,L as s,r as l,n,g as o,t as u,A as r,i as d,j as c,q as p,d as f,F as m,V as _,u as y,l as g,k as v}from"./index-0333b418.js";import{a as h,b as x}from"./uni-list.cc31cbe4.js";import{r as b}from"./uni-app.es.6fb9258e.js";import{_ as C}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as j}from"./scroll-page.1487e938.js";import{p as k,_ as S}from"./payment.0592d585.js";import{u as T}from"./consult.658795ea.js";import{p as w,c as z}from"./consult.38902923.js";import{p as I}from"./patient.3a4dde9c.js";import"./uni-icons.306a74c1.js";import"./uni-popup.15682734.js";import"./http.dd4042ae.js";const $=C({name:"UniSection",emits:["click"],props:{type:{type:String,default:""},title:{type:String,required:!0,default:""},titleFontSize:{type:String,default:"14px"},titleColor:{type:String,default:"#333"},subTitle:{type:String,default:""},subTitleFontSize:{type:String,default:"12px"},subTitleColor:{type:String,default:"#999"},padding:{type:[Boolean,String],default:!1}},computed:{_padding(){return"string"==typeof this.padding?this.padding:this.padding?"10px":""}},watch:{title(t){uni.report&&""!==t&&uni.report("title",t)}},methods:{onClick(){this.$emit("click")}}},[["render",function(p,f,m,_,y,g){const v=d,h=c;return t(),e(v,{class:"uni-section"},{default:a((()=>[i(v,{class:"uni-section-header",onClick:g.onClick},{default:a((()=>[m.type?(t(),e(v,{key:0,class:s(["uni-section-header__decoration",m.type])},null,8,["class"])):l(p.$slots,"decoration",{key:1},void 0,!0),i(v,{class:"uni-section-header__content"},{default:a((()=>[i(h,{style:n({"font-size":m.titleFontSize,color:m.titleColor}),class:s(["uni-section__content-title",{distraction:!m.subTitle}])},{default:a((()=>[o(u(m.title),1)])),_:1},8,["style","class"]),m.subTitle?(t(),e(h,{key:0,style:n({"font-size":m.subTitleFontSize,color:m.subTitleColor}),class:"uni-section-header__content-sub"},{default:a((()=>[o(u(m.subTitle),1)])),_:1},8,["style"])):r("",!0)])),_:1}),i(v,{class:"uni-section-header__slot-right"},{default:a((()=>[l(p.$slots,"right",{},void 0,!0)])),_:3})])),_:3},8,["onClick"]),i(v,{class:"uni-section-content",style:n({padding:g._padding})},{default:a((()=>[l(p.$slots,"default",{},void 0,!0)])),_:3},8,["style"])])),_:3})}],["__scopeId","data-v-0a8818d5"]]),F=C({__name:"index",setup(e){const{type:s,illnessType:l,patientId:n,illnessInfo:r,depId:C}=T(),F=p({}),q=p({}),A=p(""),D=p();async function P(){if(""!==A.value)return uni.utils.toast("不能重复创建订单!");r.pictures=r.pictures.map((({url:t,uuid:e})=>({id:e,url:t})));const{code:t,data:e,message:a}=await z({type:s,illnessType:l,depId:C,patientId:n,...r});if(1e4!==t)return uni.utils.toast(a);A.value=e.id,D.value.open()}async function U(){const{confirm:t}=await _({title:"关闭支付",content:"取消支付将无法获得医生回复，医生接诊名额有限，是否确认关闭？",cancelText:"仍要关闭",cancelColor:"#848484",confirmText:"继续支付",confirmColor:"#16C2A3"});t||D.value.close()}async function V({index:t}){if(0===t)return uni.utils.toast("暂不支持微信支付!");const{code:e,data:a,message:i}=await k({orderId:A.value,paymentMethod:t,payCallback:"http://localhost/subpkg_consult/room/index"});if(1e4!==e)return uni.utils.toast(i);window.location.href=a.payUrl}return p(),async function(){const{code:t,data:e,message:a}=await w(s,{illnessType:l});if(1e4!==t)return uni.utils.toast(a);F.value=e}(),async function(){const{code:t,data:e,message:a}=await I(n);if(1e4!==t)return uni.utils.toast(a);q.value=e}(),(e,s)=>{const l=b(g("uni-list-item"),h),n=d,p=b(g("uni-list"),x),_=b(g("uni-section"),$),C=c,k=v,T=b(g("scroll-page"),j),w=b(g("custom-payment"),S);return t(),f(m,null,[i(T,null,{default:a((()=>[i(n,{class:"payment-page"},{default:a((()=>[i(_,{"title-font-size":"32rpx","title-color":"#121826",padding:"30rpx",title:`图文问诊 ${F.value.payment}元`},{default:a((()=>[i(p,{border:!1},{default:a((()=>[i(l,{title:"极速问诊",note:"自动分配医生",thumb:"/static/uploads/doctor-avatar.jpg","thumb-size":"lg"}),i(l,{title:"优惠券","show-arrow":"","right-text":`-¥${F.value.couponDeduction}`},null,8,["right-text"]),i(l,{title:"积分抵扣"},{footer:a((()=>[i(n,{class:"uni-list-text-red"},{default:a((()=>[o(" -¥"+u(F.value.pointDeduction),1)])),_:1})])),_:1}),i(l,{title:"实付款"},{footer:a((()=>[i(n,{class:"uni-list-text-red"},{default:a((()=>[o(" ¥"+u(F.value.actualPayment),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["title"]),i(n,{class:"dividing-line"}),i(_,{"title-font-size":"32rpx","title-color":"#121826",padding:"30rpx",title:"患者资料"},{default:a((()=>[i(p,{border:!1},{default:a((()=>[i(l,{title:"患者信息"},{footer:a((()=>[i(n,{class:"uni-list-text-gray"},{default:a((()=>[o(u(q.value.name)+" | "+u(q.value.genderValue)+" | "+u(q.value.age)+"岁 ",1)])),_:1})])),_:1}),i(l,{border:"",title:"病情描述",note:y(r).illnessDesc},null,8,["note"])])),_:1})])),_:1})])),_:1}),i(n,{class:"next-step"},{default:a((()=>[i(n,{class:"total-amount"},{default:a((()=>[o(" 合计: "),i(C,{class:"number"},{default:a((()=>[o("¥"+u(F.value.actualPayment),1)])),_:1})])),_:1}),i(k,{onClick:P,class:"uni-button"},{default:a((()=>[o("立即支付")])),_:1})])),_:1})])),_:1}),i(w,{onClose:U,onConfirm:V,amount:F.value.actualPayment,"order-id":A.value,ref_key:"paymentRef",ref:D},null,8,["amount","order-id"])],64)}}},[["__scopeId","data-v-dfaf2eb5"]]);export{F as default};
